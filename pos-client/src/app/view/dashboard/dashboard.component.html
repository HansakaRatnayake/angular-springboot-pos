<div class="dashboard">
  <div class="main-content">
    <div class="header">
      <div>
        <div class="welcome">{{greeting}}, {{ user }}</div>
        <div class="date">{{currentTime}}</div>
      </div>
      <div class="search-bar">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Search...">
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card" *ngFor="let stat of stats">
        <div class="stat-title">{{ stat.title }}</div>
        <div class="stat-value">{{stat.title==='Total Sales'? (stat.value | currency:'LKR' ): (stat.value)}}</div>
        <div class="stat-change" [ngStyle]="{'color': stat.increase ? '#059669' : '#dc2626'}">
          <svg *ngIf="stat.increase" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
          <svg *ngIf="!stat.increase" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
          {{ stat.change }} from last week
        </div>
      </div>
    </div>

    <div class="chart-section">
      <div class="section-header">
        <div class="section-title">Sales Overview</div>
        <div class="time-filter">
          <button class="filter-btn" *ngFor="let filter of timeFilters"
                  [ngClass]="{'active': isActiveTimeFilter(filter)}"
                  (click)="setTimeFilter(filter)">{{ filter }}</button>
        </div>
      </div>
      <div class="chart-container">
        <canvas id="salesChart"></canvas>
      </div>
      <div class="graph-legend">
        <div class="legend-item">
          <div class="legend-dot" style="background-color: rgba(59, 130, 246, 0.8);"></div>
          <span>Revenue</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background-color: rgba(99, 102, 241, 0.4);"></div>
          <span>Orders</span>
        </div>
      </div>
    </div>

    <div class="data-grid">
      <div class="data-section">
        <div class="section-header">
          <div class="section-title">Recent Orders</div>
          <button class="filter-btn" routerLink="/orders">View All</button>
        </div>
        <div class="table-container">
          <table>
            <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Date</th>
              <th>Amount</th>

            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let order of recentOrders">
              <td>{{ order?.orderId }}</td>
              <td>{{ order?.customer?.customerName}}</td>
              <td>{{ order?.date | date:'YYYY-MM-dd' }}</td>
              <td>{{ order?.nett | currency:'LKR' }}</td>
<!--              <td>-->
<!--                <span class="status" [ngClass]="order.status.toLowerCase()">{{ order.status }}</span>-->
<!--              </td>-->
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Top products -->
      <div class="data-section">
        <div class="section-header">
          <div class="section-title">Top Products</div>
          <button class="filter-btn" routerLink="/products">View products</button>
        </div>
        <div class="table-container">
          <table>
            <thead>
            <tr>
              <th>Product</th>
              <th>Sales</th>
              <th>Price</th>
              <th>Stock</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let product of topProducts">
              <td>{{ product.product.description }}</td>
              <td>{{ product.salesUnits }}</td>
              <td>{{ product.price }}</td>
              <td>{{ product.stock }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
